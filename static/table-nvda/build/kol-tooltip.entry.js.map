{"version":3,"names":["VISIBLE_OVERLAYS","Set","showOverlay","overlay","forEach","visibleOverlay","style","setProperty","add","hideOverlay","delete","size","last","Array","from","pop","styleCss","KolTooltip","this","alignTooltip","processEnv","previousSibling","tooltipElement","target","tooltipEl","arrowEl","arrowElement","middleware","offset","_a","offsetHeight","flip","shift","push","arrow","element","computePosition","placement","state","_align","then","x","y","middlewareData","Object","assign","left","top","visibility","bottom","_b","offsetWidth","right","showTooltip","getDocument","body","addEventListener","hideTooltipByEscape","cleanupAutoPositioning","autoUpdate","hideTooltip","undefined","event","key","removeEventListener","addListeners","el","incrementOverFocusCount","decrementOverFocusCount","removeListeners","resyncListeners","catchHostElement","previousElementSibling","catchTooltipElement","catchArrowElement","overFocusCount","showOrHideTooltip","clearTimeout","overFocusTimeout","setTimeout","_id","nonce","_label","render","h","Host","ref","id","class","validateAlign","value","watchTooltipAlignment","validateId","watchString","validateLabel","componentWillLoad","disconnectedCallback"],"sources":["src/utils/overlay.ts","src/components/tooltip/style.css?tag=kol-tooltip","src/components/tooltip/component.tsx"],"sourcesContent":["/**\r\n * This file contains the functions used to manage the visible overlays.\r\n */\r\n\r\n/**\r\n * This set contains all the visible overlays.\r\n */\r\nconst VISIBLE_OVERLAYS: Set<HTMLElement> = new Set();\r\n\r\n/**\r\n * This function is used to add an overlay to the visible overlay list.\r\n * All overlays in the list will have a z-index of 999, except the last\r\n * one, which will have a z-index of 1000.\r\n *\r\n * @param overlay Get the overlay element reference\r\n */\r\nexport function showOverlay(overlay: HTMLElement): void {\r\n\tVISIBLE_OVERLAYS.forEach((visibleOverlay) => {\r\n\t\tvisibleOverlay.style.setProperty('z-index', '999');\r\n\t});\r\n\tVISIBLE_OVERLAYS.add(overlay);\r\n\toverlay.style.setProperty('z-index', '1000');\r\n}\r\n\r\n/**\r\n * This function is used to remove an overlay from the visible overlay list.\r\n * All overlays in the list will have a z-index of 999, except the last\r\n * one, which will have a z-index of 1000.\r\n *\r\n * @param overlay Get the overlay element reference\r\n */\r\nexport function hideOverlay(overlay: HTMLElement): void {\r\n\tVISIBLE_OVERLAYS.delete(overlay);\r\n\tif (VISIBLE_OVERLAYS.size > 0) {\r\n\t\tconst last = Array.from(VISIBLE_OVERLAYS).pop();\r\n\t\tif (last) {\r\n\t\t\tlast.style.setProperty('z-index', '1000');\r\n\t\t}\r\n\t}\r\n}\r\n","@import url(../style.css);\nkol-tooltip #floating {\n\tanimation-duration: 0.5s;\n\tanimation-iteration-count: 1;\n\tanimation-name: fadeInOpacity;\n\tanimation-timing-function: ease-in;\n\tbox-sizing: border-box;\n\tdisplay: none;\n\tposition: absolute;\n\tvisibility: hidden;\n\t/* Avoid layout interference - see https://floating-ui.com/docs/computePosition */\n\twidth: max-content;\n\ttop: 0;\n\tleft: 0;\n}\nkol-tooltip #arrow {\n\theight: 10px;\n\tposition: absolute;\n\ttransform: rotate(45deg);\n\twidth: 10px;\n\tz-index: 999;\n}\nkol-tooltip .area {\n\tbackground-color: #fff;\n\tcolor: #000;\n}\nkol-tooltip kol-span-wc {\n\tposition: relative;\n\tz-index: 1000;\n}\n@keyframes fadeInOpacity {\n\t0% {\n\t\topacity: 0;\n\t}\n\t100% {\n\t\topacity: 1;\n\t}\n}\n","import { arrow, autoUpdate, computePosition, flip, offset, shift } from '@floating-ui/dom';\r\nimport { Component, Host, JSX, Prop, State, Watch, h } from '@stencil/core';\r\n\r\nimport { watchTooltipAlignment } from '../../types/button-link';\r\nimport { Align } from '../../types/props/align';\r\nimport { LabelPropType, validateLabel } from '../../types/props/label';\r\nimport { getDocument, nonce } from '../../utils/dev.utils';\r\nimport { hideOverlay, showOverlay } from '../../utils/overlay';\r\nimport { watchString } from '../../utils/prop.validators';\r\nimport { processEnv } from '../../utils/reuse';\r\nimport { KoliBriTooltipAPI, KoliBriTooltipStates } from './types';\r\n\r\n@Component({\r\n\ttag: 'kol-tooltip',\r\n\tstyleUrl: './style.css',\r\n\tshadow: false,\r\n})\r\nexport class KolTooltip implements KoliBriTooltipAPI {\r\n\tprivate previousSibling?: HTMLElement | null;\r\n\tprivate tooltipElement?: HTMLDivElement;\r\n\tprivate arrowElement?: HTMLDivElement;\r\n\tprivate cleanupAutoPositioning?: () => void;\r\n\r\n\tprivate alignTooltip = (): void => {\r\n\t\tif (processEnv !== 'test' && this.previousSibling /* SSR instanceof HTMLElement */ && this.tooltipElement /* SSR instanceof HTMLElement */) {\r\n\t\t\tconst target = this.previousSibling;\r\n\t\t\tconst tooltipEl = this.tooltipElement;\r\n\t\t\tconst arrowEl = this.arrowElement;\r\n\r\n\t\t\tconst middleware = [offset(arrowEl?.offsetHeight ?? 10), flip(), shift()];\r\n\t\t\tif (arrowEl) {\r\n\t\t\t\tmiddleware.push(arrow({ element: arrowEl }));\r\n\t\t\t}\r\n\r\n\t\t\tvoid computePosition(target, tooltipEl, {\r\n\t\t\t\tplacement: this.state._align,\r\n\t\t\t\tmiddleware: middleware,\r\n\t\t\t}).then(({ x, y, middlewareData, placement }) => {\r\n\t\t\t\tObject.assign(tooltipEl.style, {\r\n\t\t\t\t\tleft: `${x}px`,\r\n\t\t\t\t\ttop: `${y}px`,\r\n\t\t\t\t\tvisibility: 'visible',\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (arrowEl) {\r\n\t\t\t\t\tif (middlewareData.arrow?.x) {\r\n\t\t\t\t\t\tObject.assign(arrowEl.style, {\r\n\t\t\t\t\t\t\tleft: `${middlewareData.arrow.x}px`,\r\n\t\t\t\t\t\t\ttop: placement === 'bottom' ? `${-arrowEl.offsetHeight / 2}px` : '',\r\n\t\t\t\t\t\t\tbottom: placement === 'top' ? `${-arrowEl.offsetHeight / 2}px` : '',\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (middlewareData.arrow?.y) {\r\n\t\t\t\t\t\tObject.assign(arrowEl.style, {\r\n\t\t\t\t\t\t\tleft: placement === 'right' ? `${-arrowEl.offsetWidth / 2}px` : '',\r\n\t\t\t\t\t\t\tright: placement === 'left' ? `${-arrowEl.offsetWidth / 2}px` : '',\r\n\t\t\t\t\t\t\ttop: `${middlewareData.arrow.y}px`,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tprivate showTooltip = (): void => {\r\n\t\tif (this.previousSibling && this.tooltipElement /* SSR instanceof HTMLElement */) {\r\n\t\t\tshowOverlay(this.tooltipElement);\r\n\t\t\tthis.tooltipElement.style.setProperty('display', 'block');\r\n\t\t\tgetDocument().body.addEventListener('keyup', this.hideTooltipByEscape);\r\n\r\n\t\t\tconst target = this.previousSibling;\r\n\t\t\tconst tooltipEl = this.tooltipElement;\r\n\t\t\tthis.cleanupAutoPositioning = autoUpdate(target, tooltipEl, this.alignTooltip);\r\n\t\t}\r\n\t};\r\n\r\n\tprivate hideTooltip = (): void => {\r\n\t\tif (this.tooltipElement /* SSR instanceof HTMLElement */) {\r\n\t\t\thideOverlay(this.tooltipElement);\r\n\t\t\tthis.tooltipElement.style.setProperty('display', 'none');\r\n\t\t\tthis.tooltipElement.style.setProperty('visibility', 'hidden');\r\n\t\t\tif (this.cleanupAutoPositioning) {\r\n\t\t\t\tthis.cleanupAutoPositioning();\r\n\t\t\t\tthis.cleanupAutoPositioning = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tprivate hideTooltipByEscape = (event: KeyboardEvent): void => {\r\n\t\tif (event.key === 'Escape') {\r\n\t\t\tgetDocument().body.removeEventListener('keyup', this.hideTooltipByEscape);\r\n\t\t\tthis.hideTooltip();\r\n\t\t}\r\n\t};\r\n\r\n\tprivate addListeners = (el: Element): void => {\r\n\t\tel.addEventListener('mouseover', this.incrementOverFocusCount);\r\n\t\tel.addEventListener('focus', this.incrementOverFocusCount);\r\n\t\tel.addEventListener('mouseout', this.decrementOverFocusCount);\r\n\t\tel.addEventListener('blur', this.decrementOverFocusCount);\r\n\t};\r\n\r\n\tprivate removeListeners = (el: Element): void => {\r\n\t\tel.removeEventListener('mouseover', this.incrementOverFocusCount);\r\n\t\tel.removeEventListener('focus', this.incrementOverFocusCount);\r\n\t\tel.removeEventListener('mouseout', this.decrementOverFocusCount);\r\n\t\tel.removeEventListener('blur', this.decrementOverFocusCount);\r\n\t};\r\n\r\n\tprivate resyncListeners = (el: Element): void => {\r\n\t\tthis.removeListeners(el);\r\n\t\tthis.addListeners(el);\r\n\t};\r\n\r\n\tprivate catchHostElement = (el: HTMLElement | null): void => {\r\n\t\tif (el /* SSR instanceof HTMLElement */) {\r\n\t\t\tthis.previousSibling = el.previousElementSibling as HTMLElement | null;\r\n\t\t\tif (this.previousSibling /* SSR instanceof HTMLElement */) {\r\n\t\t\t\tthis.resyncListeners(this.previousSibling);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tprivate catchTooltipElement = (el?: HTMLDivElement): void => {\r\n\t\tthis.tooltipElement = el;\r\n\t\tif (this.tooltipElement /* SSR instanceof HTMLElement */) {\r\n\t\t\tthis.resyncListeners(this.tooltipElement);\r\n\t\t}\r\n\t};\r\n\tprivate catchArrowElement = (element?: HTMLDivElement): void => {\r\n\t\tthis.arrowElement = element;\r\n\t};\r\n\r\n\tpublic render(): JSX.Element {\r\n\t\treturn (\r\n\t\t\t<Host ref={this.catchHostElement}>\r\n\t\t\t\t{this.state._label !== '' && (\r\n\t\t\t\t\t<div id=\"floating\" ref={this.catchTooltipElement}>\r\n\t\t\t\t\t\t<div class=\"area\" id=\"arrow\" ref={this.catchArrowElement} />\r\n\t\t\t\t\t\t<kol-span-wc class=\"area\" id={this.state._id} _label={this.state._label}></kol-span-wc>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t</Host>\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Setzt die Ausrichtung des Tooltips in Relation zum Elternelement.\r\n\t */\r\n\t@Prop() public _align?: Align = 'top';\r\n\r\n\t/**\r\n\t * Gibt die interne ID des primären Elements in der Komponente an.\r\n\t */\r\n\t@Prop() public _id!: string;\r\n\r\n\t/**\r\n\t * Setzt die sichtbare oder semantische Beschriftung der Komponente (z.B. Aria-Label, Label, Headline, Caption, Summary usw.).\r\n\t */\r\n\t@Prop() public _label!: LabelPropType;\r\n\r\n\t@State() public state: KoliBriTooltipStates = {\r\n\t\t_align: 'top',\r\n\t\t_id: nonce(),\r\n\t\t_label: '…', // ⚠ required\r\n\t};\r\n\r\n\t@Watch('_align')\r\n\tpublic validateAlign(value?: Align): void {\r\n\t\twatchTooltipAlignment(this, '_align', value);\r\n\t}\r\n\r\n\t@Watch('_id')\r\n\tpublic validateId(value?: string): void {\r\n\t\twatchString(this, '_id', value);\r\n\t}\r\n\r\n\t@Watch('_label')\r\n\tpublic validateLabel(value?: LabelPropType): void {\r\n\t\tvalidateLabel(this, value);\r\n\t}\r\n\r\n\tprivate overFocusCount = 0;\r\n\tprivate overFocusTimeout?: ReturnType<typeof setTimeout>;\r\n\r\n\tprivate incrementOverFocusCount = (): void => {\r\n\t\tthis.overFocusCount++;\r\n\t\tthis.showOrHideTooltip();\r\n\t};\r\n\r\n\tprivate decrementOverFocusCount = (): void => {\r\n\t\tthis.overFocusCount--;\r\n\t\tthis.showOrHideTooltip();\r\n\t};\r\n\r\n\tprivate showOrHideTooltip = (): void => {\r\n\t\tclearTimeout(this.overFocusTimeout);\r\n\t\tthis.overFocusTimeout = setTimeout(() => {\r\n\t\t\tclearTimeout(this.overFocusTimeout);\r\n\t\t\tif (this.overFocusCount > 0) {\r\n\t\t\t\tthis.showTooltip();\r\n\t\t\t} else {\r\n\t\t\t\tthis.hideTooltip();\r\n\t\t\t}\r\n\t\t}, 250);\r\n\t};\r\n\r\n\tpublic componentWillLoad(): void {\r\n\t\tthis.validateAlign(this._align);\r\n\t\tthis.validateId(this._id);\r\n\t\tthis.validateLabel(this._label);\r\n\t}\r\n\r\n\t/**\r\n\t * @see: components/abbr/component.tsx (componentDidLoad)\r\n\t */\r\n\tpublic disconnectedCallback(): void {\r\n\t\tif (this.previousSibling /* SSR instanceof HTMLElement */) {\r\n\t\t\tthis.removeListeners(this.previousSibling);\r\n\t\t}\r\n\t\tif (this.tooltipElement /* SSR instanceof HTMLElement */) {\r\n\t\t\tthis.removeListeners(this.tooltipElement);\r\n\t\t}\r\n\t\tif (this.cleanupAutoPositioning) {\r\n\t\t\tthis.cleanupAutoPositioning();\r\n\t\t}\r\n\t}\r\n}\r\n"],"mappings":"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"}